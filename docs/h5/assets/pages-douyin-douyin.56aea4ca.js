var t=Object.defineProperty,e=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,a=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,l=(t,e)=>{for(var s in e||(e={}))o.call(e,s)&&a(t,s,e[s]);if(i)for(var s of i(e))n.call(e,s)&&a(t,s,e[s]);return t},r=(t,i)=>e(t,s(i));import{d as h,A as p,l as c,o as u,c as d,w as m,a as v,m as g,u as y,s as f,n as w,g as x,h as b,k as M,r as T,x as $,B as _,e as P,f as j,F as X,C as H,y as O,D,b as U,t as I}from"./index.1977e9bd.js";import{_ as S}from"./m-loading-icon.5831534a.js";import{_ as E}from"./m-status-bar.25face9c.js";import{_ as k}from"./plugin-vue_export-helper.21dcd24c.js";var Y={options:{type:Object,default:()=>{}}},C=null;const W={data:()=>({ins:null,timer:null,me:{},self:{top:0,oldTop:0,isTouch:!1,startXY:{x:0,y:0},isDown:!1,isUp:!1,isPrevent:!1}}),mounted(){this.ins||(this.ins=this.$ownerInstance)},methods:{propObserver(t={}){this.me=t,!this.me.loading&&this.ins&&(this.onMoving({cls:".m-swiper-down .right",style:{opacity:0,transition:"none"}}),this.onMoving({cls:".m-swiper-down .left",style:{opacity:0,transition:"none"}}))},onMoving(t={}){const{cls:e=".m-swiper-box",top:s=0,type:i="none",style:o={},time:n=null}=t,a=l({"will-change":"transform",top:`${s}px`,transition:`${i} 0.5s`},o);n?(this.timer&&(this.ins.clearTimeout(C),this.timer=null),this.timer=this.ins.setTimeout((()=>{this.ins.requestAnimationFrame((()=>{this.ins.selectComponent(e).setStyle(a),".m-swiper-box"===e&&"top"===i&&(this.self.top=s)})),C=null}),n)):this.ins.requestAnimationFrame((()=>{this.ins.selectComponent(e).setStyle(a),".m-swiper-box"===e&&"top"===i&&(this.self.top=s)}))},setIndex(t={}){const{index:e=0}=t,s=this.me.index+-1*e;return!(s>this.me.len-1)&&(!(s<0)&&(this.me.index=s,this.ins.callMethod("$emitWXS",{type:"setIndex",value:s}),!0))},funPrevent(t){return!!this.self.isPrevent&&(t.stopPropagation(),t.preventDefault(),!0)},touchstartEvent(t){this.funPrevent(t);const e=t.changedTouches||[],s=e[0].pageX||0,i=e[0].pageY||0;!e.length||e.length>=2||(this.self.isTouch=!0,this.self.oldTop=this.self.top,this.self.startXY={x:s,y:i})},touchmoveEvent(t){this.funPrevent(t);const{startXY:e,oldTop:s,isTouch:i}=this.self,o=this.me.index;if(!i)return;const n=t.changedTouches||[],a=n[0].pageX||0,l=n[0].pageY||0,r=a-e.x,h=l-e.y,p=Math.abs(h)-Math.abs(r);if(p<0&&p<10)return;h<0&&!this.self.isDown&&(this.self.isMoveUP=!0);const c=Math.abs(h);if(h>0&&0===o&&!this.self.isMoveUP&&(this.self.isDown=!0),h<0&&o===this.me.len-1&&(this.self.isUp=!0),this.self.isDown){let t=0,e=0;return h>this.me.dH?(t=this.me.dH,e=1):(t=h,e=h/this.me.dH),e=h<-1*this.me.dH?1:Math.abs(h/this.me.dH),e>1&&(e=1),!this.me.loading&&this.onMoving({cls:".m-swiper-down",top:t,style:{opacity:1}}),!this.me.loading&&this.onMoving({cls:".m-swiper-down .left",style:{opacity:e}}),!this.me.loading&&this.onMoving({cls:".m-swiper-down .right",style:{opacity:e}}),void this.ins.callMethod("$emitWXS",{type:"header",value:{opacity:1-e,top:t}})}if(this.self.isUp){let t=0,e=this.me.maxH;return t=h<e?e:h,void this.onMoving({top:s+t})}if(h>0&&o)this.onMoving({top:s+c});else if(0===o&&h>0){const t=s-c;this.onMoving({top:t<0?0:t})}else this.onMoving({top:s-c})},touchendEvent(t){this.funPrevent(t);const{loading:e,index:s,height:i}=this.me,{startXY:o,oldTop:n,isTouch:a}=this.self;if(!a)return;const l=t.changedTouches||[],r=(l[0].pageX,l[0].pageY||0);o.x;const h=r-o.y,p=Math.abs(h);this.self.isTouch=!1,this.self.isMoveUP=!1;const c=h>0?1:-1;if(this.self.isDown)return this.self.isDown=!1,h>=this.me.dH&&!e?(this.onMoving({cls:".m-swiper-down",top:0,style:{transition:"all 0.5s"}}),this.onMoving({cls:".m-swiper-down .left",style:{opacity:0,transition:"all 0.5s"},time:1e3}),this.onMoving({cls:".m-swiper-down .right",style:{opacity:1,transition:"all 0.5s"}}),this.ins.callMethod("$emitWXS",{type:"isDown",value:!0})):(this.onMoving({cls:".m-swiper-down",top:0,style:{transition:"none 0.5s"}}),this.onMoving({cls:".m-swiper-down .left",style:{opacity:0,transition:"none 0.5s"}}),this.onMoving({cls:".m-swiper-down .right",style:{opacity:0,transition:"none 0.5s"}}),this.ins.callMethod("$emitWXS",{type:"header",value:{opacity:1,top:0}})),void this.onMoving({top:n,type:"top"});if(this.self.isUp){this.self.isUp=!1;return h<=this.me.maxH&&!e&&this.ins.callMethod("$emitWXS",{type:"isUp",value:!0}),void this.onMoving({top:n,type:"top"})}if(p<this.me.scrollH)return void this.onMoving({top:n,type:"top"});this.setIndex({index:c})?this.onMoving({top:n+i*c,type:"top"}):this.onMoving({top:n,type:"top"})}}};var A=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("wxs"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.wxs=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push(W)};const B=h({emits:["change"],methods:{$emitWXS(t){this.$emit("change",t)}}}),F=h(r(l({},B),{__name:"m-douyin",props:Y,setup(t){const e=t;p().proxy;const s=c((()=>{const{height:t,width:s}=e.options;return{width:`${s}px`,height:`${t}px`}})),i=c((()=>({height:`${uni.$m.sys().customBar}px`}))),o=c((()=>"")),n=c((()=>{const{height:t,width:s,data:i=[]}=e;return{width:`${s}px`,height:t*i.length+"px"}}));return(t,a)=>{const l=x(b("m-loading-icon"),S),r=M,h=x(b("m-status-bar"),E);return u(),d(r,{class:"m-swiper","change:prop":t.wxs.propObserver,prop:e.options,style:g(y(s)),onTouchstart:t.wxs.touchstartEvent,onTouchmove:t.wxs.touchmoveEvent,onTouchend:t.wxs.touchendEvent,onTouchcancel:t.wxs.touchendEvent},{default:m((()=>[v(r,{class:"m-swiper-up",style:g(y(s))},{default:m((()=>[v(l,{class:"loading",size:14,duration:900,mode:"bicircle"})])),_:1},8,["style"]),v(r,{class:"m-swiper-box",style:g(y(n))},{default:m((()=>[f(t.$slots,"default",{},void 0,!0)])),_:3},8,["style"]),v(r,{class:"m-swiper-down",style:g(y(i))},{default:m((()=>[v(h),v(r,{class:"m-swiper-down-box"},{default:m((()=>[v(r,{class:"left"}),v(r,{class:w(["right",y(o)])},{default:m((()=>[v(l,{size:14,duration:900,mode:"bicircle"})])),_:1},8,["class"])])),_:1})])),_:1},8,["style"])])),_:3},8,["change:prop","prop","style","onTouchstart","onTouchmove","onTouchend","onTouchcancel"])}}}));A(F);var q=k(F,[["__scopeId","data-v-4173b486"]]);var z=k(h({__name:"douyin",setup(t){const e=T(0),s=T(0),i=T(0),o=T(["red","blue","pink","yellow"]),n=T(!1),a=T(1),h=T(0),f=T(!1),w=c((()=>({width:`${s.value}px`,height:`${e.value}px`}))),S=c((()=>f.value?{opacity:a.value,transition:"all 0.5s",top:h.value/2+"px"}:{opacity:1,transition:"all 0.1s",top:0})),E=c({get:()=>({len:o.value.length,index:i.value,height:e.value,width:s.value,loading:n.value,maxH:-1*H(200),scrollH:H(200),dH:uni.$m.sys.customBar}),set(t){const{type:e,value:s}=t;switch(e){case"isUp":n.value=s,setTimeout((()=>{n.value=!1}),3e3);break;case"setIndex":i.value=s;break;case"isDown":n.value=s,setTimeout((()=>{n.value=!1,f.value=!1}),3e3);break;case"header":a.value=s.opacity,f.value=!0,h.value=s.top}}}),k=t=>E.value=t;return $((()=>{const t=p().proxy;console.log(t),_((()=>{O().select(".page").boundingClientRect((t=>{const{width:i=0,height:o=0}=t;e.value=o,s.value=i})).exec()}))})),(t,e)=>{const s=D("m-header"),n=M,a=x(b("m-douyin"),q);return u(),d(n,{class:"page"},{default:m((()=>[v(s,{"left-color":"#fff",sty:y(S),title:"测试标题测试标题测试标题测试标题测试标题"},null,8,["sty"]),v(a,{options:y(E),onChange:k},{default:m((()=>[(u(!0),P(X,null,j(o.value,(t=>(u(),d(n,{key:t,style:g(r(l({},y(w)),{background:t})),class:"item"},{default:m((()=>[U(I(t)+" "+I(i.value),1)])),_:2},1032,["style"])))),128))])),_:1},8,["options"])])),_:1})}}}),[["__scopeId","data-v-c32d2ee4"]]);export{z as default};
//# sourceMappingURL=pages-douyin-douyin.56aea4ca.js.map
