{"version":3,"file":"m-popup.d9f0644f.js","sources":["../../../../../uni_modules/mview-ui/components/m-safe-bottom/props.ts","../../../../../uni_modules/mview-ui/components/m-safe-bottom/m-safe-bottom.vue","../../../../../uni_modules/mview-ui/components/m-popup/props.ts","../../../../../uni_modules/mview-ui/components/m-popup/m-popup.vue"],"sourcesContent":["export default {\n    ...uni.$m.config.props\n}\n","<template>\n    <view\n        class=\"m-safe-bottom\"\n        :style=\"[style]\"\n        :class=\"[!isNvue && 'm-safe-area-inset-bottom']\"\n    >\n    </view>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, onMounted, computed } from 'vue'\nimport Props from './props'\n\nconst props = defineProps(Props)\nconst isNvue = ref(false)\n\nonMounted(() => {\n    // #ifdef APP-NVUE\n    isNvue.value = true\n    // #endif\n})\n\nconst style = () => {\n    const style = {}\n\n    // #ifdef APP-NVUE\n    // nvue下，高度使用js计算填充\n    style.height = uni.$m.sys().safeAreaInsets.bottom + 'px'\n    // #endif\n    return {\n        ...style,\n        ...uni.$m.addStyle(props.customStyle)\n    }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../../libs/css/components.scss\";\n.m-safe-bottom {\n    /* #ifndef APP-NVUE */\n    width: 100%;\n    /* #endif */\n}\n</style>\n","export default {\n    ...uni.$m.config.props,\n    // 是否展示弹窗\n    show: {\n        type: Boolean,\n        default: uni.$m.props.popup.show\n    },\n    // 是否显示遮罩\n    overlay: {\n        type: Boolean,\n        default: uni.$m.props.popup.overlay\n    },\n    // 弹出的方向，可选值为 top bottom right left center\n    mode: {\n        type: String,\n        default: uni.$m.props.popup.mode\n    },\n    // 动画时长，单位ms\n    duration: {\n        type: [String, Number],\n        default: uni.$m.props.popup.duration\n    },\n    // 是否显示关闭图标\n    closeable: {\n        type: Boolean,\n        default: uni.$m.props.popup.closeable\n    },\n    // 自定义遮罩的样式\n    overlayStyle: {\n        type: [Object, String],\n        default: uni.$m.props.popup.overlayStyle\n    },\n    // 点击遮罩是否关闭弹窗\n    closeOnClickOverlay: {\n        type: Boolean,\n        default: uni.$m.props.popup.closeOnClickOverlay\n    },\n    // 层级\n    zIndex: {\n        type: [String, Number],\n        default: uni.$m.props.popup.zIndex\n    },\n    // 是否为iPhoneX留出底部安全距离\n    safeAreaInsetBottom: {\n        type: Boolean,\n        default: uni.$m.props.popup.safeAreaInsetBottom\n    },\n    // 是否留出顶部安全距离（状态栏高度）\n    safeAreaInsetTop: {\n        type: Boolean,\n        default: uni.$m.props.popup.safeAreaInsetTop\n    },\n    // 自定义关闭图标位置，top-left为左上角，top-right为右上角，bottom-left为左下角，bottom-right为右下角\n    closeIconPos: {\n        type: String,\n        default: uni.$m.props.popup.closeIconPos\n    },\n    // 是否显示圆角\n    round: {\n        type: [Boolean, String, Number],\n        default: uni.$m.props.popup.round\n    },\n    // mode=center，也即中部弹出时，是否使用缩放模式\n    zoom: {\n        type: Boolean,\n        default: uni.$m.props.popup.zoom\n    },\n    // 弹窗背景色，设置为transparent可去除白色背景\n    bgColor: {\n        type: String,\n        default: uni.$m.props.popup.bgColor\n    },\n    // 遮罩的透明度，0-1之间\n    overlayOpacity: {\n        type: [Number, String],\n        default: uni.$m.props.popup.overlayOpacity\n    }\n}\n","<template>\n    <view class=\"m-popup\">\n        <m-overlay\n            v-if=\"props.overlay\"\n            :show=\"props.show\"\n            :duration=\"props.duration\"\n            :custom-style=\"props.overlayStyle\"\n            :opacity=\"props.overlayOpacity\"\n            @click=\"overlayClick\"\n        ></m-overlay>\n        <m-transition\n            :show=\"props.show\"\n            :mode=\"position\"\n            :duration=\"props.duration\"\n            :custom-style=\"transitionStyle\"\n            @after-enter=\"afterEnter\"\n            @click=\"handleClick\"\n        >\n            <view\n                class=\"m-popup__content\"\n                :style=\"[contentStyle]\"\n                @tap.stop=\"$m.noop\"\n            >\n                <m-status-bar v-if=\"props.safeAreaInsetTop\"></m-status-bar>\n                <slot></slot>\n                <view\n                    v-if=\"props.closeable\"\n                    class=\"m-popup__content__close\"\n                    :class=\"['m-popup__content__close--' + closeIconPos]\"\n                    hover-class=\"m-popup__content__close--hover\"\n                    hover-stay-time=\"150\"\n                    @tap=\"close\"\n                >\n                    <m-icon\n                        name=\"close\"\n                        color=\"#909399\"\n                        size=\"18\"\n                        bold\n                    ></m-icon>\n                </view>\n                <m-safe-bottom v-if=\"props.safeAreaInsetBottom\"></m-safe-bottom>\n            </view>\n        </m-transition>\n    </view>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, watch, ref } from 'vue'\nimport Props from './props'\n\nconst props = defineProps(Props)\nconst emits = defineEmits(['close', 'open', 'click'])\nconst $popup = ref(null)\n\n// #ifdef MP-WEIXIN\nwatch(() => props.show, newValue => {\n    if (newValue === true) {\n        // #ifdef MP-WEIXIN\n        if (!$popup.value) return\n        const children = $popup.value.$el.children\n        retryComputedComponentRect(children)\n        // #endif\n    }\n})\n\nfunction retryComputedComponentRect(children) {\n    // 组件内部需要计算节点的组件\n    const names = ['m-header', 'm-tabbar'].join(' ')\n    // 历遍所有的子组件节点\n    for(let i = 0; i < children.length; i++) {\n        const child = children[i]\n        // 拿到子组件的子组件\n        const grandChild = child.children\n        // 判断如果在需要重新初始化的组件数组中名中，并且存在init方法的话，则执行\n        let clsNames = child.className ?? ''\n        clsNames = clsNames.split(' ')\n        const has = clsNames.filter(item => names.indexOf(item) !== -1)\n        if (has.length && typeof child.init === 'function') {\n            // 需要进行一定的延时，因为初始化页面需要时间\n            // 需要进行一定的延时，因为初始化页面需要时间\n            uni.$m.sleep(50).then(() => {\n                child.init()\n            })\n        }\n\n        if (grandChild.length) retryComputedComponentRect(grandChild)\n    }\n}\n// #endif\n\nconst transitionStyle = computed(() => {\n    let style = {\n        zIndex: props.zIndex,\n        position: 'fixed',\n        display: 'flex',\n    }\n\n    style[props.mode] = 0\n\n    switch (props.mode){\n        case 'left':\n            style = uni.$m.deepMerge(style, {\n               bottom: 0,\n               top: 0\n            })\n            break\n        case 'right':\n            style = uni.$m.deepMerge(style, {\n               bottom: 0,\n               top: 0\n            })\n            break\n        case 'top':\n            style = uni.$m.deepMerge(style, {\n               left: 0,\n               right: 0\n            })\n            break\n        case 'bottom':\n            style = uni.$m.deepMerge(style, {\n               left: 0,\n               right: 0\n            })\n            break\n        case 'center':\n            style = uni.$m.deepMerge(style, {\n               alignItems: 'center',\n               'justify-content': 'center',\n               top: 0,\n               left: 0,\n               right: 0,\n               bottom: 0\n            })\n            break\n    }\n\n    return style\n})\n\nconst contentStyle = computed(() => {\n    const style = {}\n    const { safeAreaInsets } = uni.$m.sys()\n\n    if (props.mode !== 'center') style.flex = 1\n    if (props.bgColor) style.backgroundColor = props.bgColor\n    if (props.round) {\n        const value = props.round + 'px'\n        switch (props.mode){\n            case 'top':\n                style.borderBottomLeftRadius = value\n                style.borderBottomRightRadius = value\n                break\n            case 'bottom':\n                style.borderTopLeftRadius = value\n                style.borderTopRightRadius = value\n                break\n            case 'center':\n                style.borderRadius = value\n                break\n        }\n    }\n\n    return {\n        ...style,\n        zIndex: 10080,\n        ...uni.$m.addStyle(props.customStyle)\n    }\n})\n\nconst position = computed(() => {\n    let cls = ''\n\n    switch (props.mode){\n        case 'center':\n            cls = props.zoom ? 'fade-zoom' : 'fade'\n            break\n        case 'left':\n            cls = 'slide-left'\n            break\n        case 'right':\n            cls = 'slide-right'\n            break\n        case 'bottom':\n            cls = 'slide-up'\n            break\n        case 'top':\n            cls = 'slide-down'\n            break\n    }\n\n    return cls\n})\n\nconst overlayClick = () => {\n    if (!props.closeOnClickOverlay) return\n\n    emits('close')\n}\n\nconst close = () => {\n    emits('close')\n}\n\nconst afterEnter = () => {\n    emits('open')\n}\n\nconst handleClick = () => {\n    // 由于中部弹出时，其m-transition占据了整个页面相当于遮罩，此时需要发出遮罩点击事件，是否无法通过点击遮罩关闭弹窗\n    if (props.mode === 'center') overlayClick()\n    \n    emits('click')\n}\n</script>\n\n<style lang=\"scss\" scoped>\n@import \"../../libs/css/components.scss\";\n$m-popup-flex: 1 !default;\n$m-popup-content-background-color: #fff !default;\n\n.m-popup {\n    flex: $m-popup-flex;\n\n    &__content {\n        background-color: $m-popup-content-background-color;\n        position: relative;\n\n        &--round-top {\n            border-top-left-radius: 0;\n            border-top-right-radius: 0;\n            border-bottom-left-radius: 10px;\n            border-bottom-right-radius: 10px;\n        }\n\n        &--round-left {\n            border-top-left-radius: 0;\n            border-top-right-radius: 10px;\n            border-bottom-left-radius: 0;\n            border-bottom-right-radius: 10px;\n        }\n\n        &--round-right {\n            border-top-left-radius: 10px;\n            border-top-right-radius: 0;\n            border-bottom-left-radius: 10px;\n            border-bottom-right-radius: 0;\n        }\n\n        &--round-bottom {\n            border-top-left-radius: 10px;\n            border-top-right-radius: 10px;\n            border-bottom-left-radius: 0;\n            border-bottom-right-radius: 0;\n        }\n\n        &--round-center {\n            border-top-left-radius: 10px;\n            border-top-right-radius: 10px;\n            border-bottom-left-radius: 10px;\n            border-bottom-right-radius: 10px;\n        }\n\n        &__close {\n            position: absolute;\n\n            &--hover {\n                opacity: 0.4;\n            }\n        }\n\n        &__close--top-left {\n            top: 15px;\n            left: 15px;\n        }\n\n        &__close--top-right {\n            top: 15px;\n            right: 15px;\n        }\n\n        &__close--bottom-left {\n            bottom: 15px;\n            left: 15px;\n        }\n\n        &__close--bottom-right {\n            right: 15px;\n            bottom: 15px;\n        }\n    }\n}\n</style>\n"],"names":["__spreadValues","uni","$m","config","props","isNvue","ref","style","addStyle","customStyle","__spreadProps","show","type","Boolean","default","popup","overlay","mode","String","duration","Number","closeable","overlayStyle","Object","closeOnClickOverlay","zIndex","safeAreaInsetBottom","safeAreaInsetTop","closeIconPos","round","zoom","bgColor","overlayOpacity","transitionStyle","computed","position","display","deepMerge","bottom","top","left","right","alignItems","contentStyle","sys","flex","backgroundColor","value","borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius","borderRadius","cls","overlayClick","close","afterEnter","handleClick"],"mappings":"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"}